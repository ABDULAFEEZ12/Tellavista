<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Nelavista - Your Educational AI Companion</title>
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/nelavista.png') }}">
    <!-- Viewport for mobile and scaling -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Version tracking -->
    <meta name="version" content="1.0.2">
    <!-- Prevent cache (force reload in WebView) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <!-- Security & Compatibility -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="referrer" content="no-referrer" />
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval' data: blob:;" />
    
    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Android WebView Optimized Styles -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --light-bg: #f0f4f8;
            --dark-bg: #121212;
            --card-light: #ffffff;
            --card-dark: #1e1e1e;
            --text-light: #212529;
            --text-dark: #e9ecef;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 12px rgba(0,0,0,0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        /* Android WebView Background Fix */
        body {
            font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            background: #0f2027 !important; /* Solid dark background for Android */
            color: white;
            line-height: 1.6;
            scroll-behavior: smooth;
            overflow-x: hidden;
            font-size: 16px;
            min-height: 100vh;
        }

        /* Ensure all containers have proper backgrounds */
        .section, .tab, .messages, #side-menu {
            background-color: rgba(30, 30, 30, 0.95) !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Header styles */
        header {
            padding: 15px 10px;
            margin-bottom: 10px;
            text-align: center;
            background: transparent !important;
        }

        h1, h3 {
            text-align: center;
            margin: 15px 10px;
            font-weight: 600;
            color: white !important;
        }

        header h1 {
            font-size: 1.5rem;
            line-height: 1.3;
            color: white !important;
        }

        header h3 {
            font-size: 1rem;
            color: #ccc !important;
            line-height: 1.4;
        }

        /* Menu toggle button style */
        #menu-toggle {
            font-size: 24px;
            cursor: pointer;
            position: fixed;
            top: 15px;
            left: 12px;
            z-index: 1001;
            background: #333 !important;
            color: white !important;
            padding: 8px 10px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }

        /* Theme toggle button style */
        #theme-toggle {
            position: fixed;
            top: 15px;
            right: 12px;
            z-index: 1001;
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            font-size: 18px;
            background-color: #333 !important;
            color: white !important;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sidebar menu styles */
        #side-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background-color: #121212 !important;
            color: #fff !important;
            padding-top: 70px;
            transition: all 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        #side-menu.hidden {
            left: -280px;
        }

        #side-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #side-menu li {
            padding: 16px 20px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
            color: white !important;
        }

        #side-menu li:hover {
            background-color: #333;
        }

        #side-menu a {
            color: inherit !important;
            text-decoration: none;
            display: block;
        }

        /* Tabs styles - Android WebView Compatible */
        .tabs {
            margin-top: 80px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            padding: 0 10px;
        }

        .tab {
            padding: 12px 16px;
            border-radius: 25px;
            background-color: #333 !important;
            color: white !important;
            box-shadow: var(--shadow);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background 0.3s;
            flex: 1;
            min-width: 0;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab.active, .tab:hover {
            background-color: #555 !important;
            color: white !important;
        }

        /* Sections style - Android WebView Compatible */
        .section {
            display: none;
            padding: 15px;
            max-width: 100%;
            margin: 0 auto;
            background-color: rgba(30, 30, 30, 0.95) !important;
            color: white !important;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-top: 15px;
            width: calc(100% - 20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section.active {
            display: block;
        }

        /* Input styles - High Contrast for Android */
        input[type="text"], select {
            width: 100%;
            padding: 12px 15px;
            margin-top: 10px;
            border-radius: 8px;
            border: 2px solid #555 !important;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            background-color: #222 !important;
            color: white !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        input[type="text"]:focus, select:focus {
            border-color: var(--primary-color) !important;
            outline: none;
            background-color: #333 !important;
        }

        input[type="text"]::placeholder {
            color: #888 !important;
        }

        /* Buttons styling - High Contrast */
        button {
            margin-top: 12px;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background-color: var(--primary-color) !important;
            color: #fff !important;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: background 0.3s;
            width: 100%;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        button:hover {
            background-color: var(--primary-dark) !important;
        }

        /* Messages container styles */
        .messages {
            margin-top: 20px;
            background-color: #222 !important;
            color: white !important;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            font-family: inherit;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* User message style */
        .user-message {
            align-self: flex-end;
            background-color: #4a7ebB !important;
            color: #fff !important;
            padding: 10px 14px;
            margin-bottom: 10px;
            border-radius: 20px;
            max-width: 80%;
            font-weight: normal;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* AI message style */
        .ai-message {
            align-self: flex-start;
            background-color: #444 !important;
            color: #fff !important;
            padding: 10px 14px;
            margin-bottom: 10px;
            border-radius: 20px;
            max-width: 80%;
            font-weight: 400;
            word-wrap: break-word;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Auth status */
        .auth-status {
            text-align: center;
            padding: 10px;
            margin-top: 60px;
            font-size: 0.9rem;
            color: white !important;
            background: transparent !important;
        }

        .auth-status a {
            color: #00cba9 !important;
            text-decoration: none;
            font-weight: 500;
        }

        /* Select dropdown styling */
        select {
            background-color: #222 !important;
            color: white !important;
            border: 2px solid #555 !important;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23fff' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>") !important;
        }

        /* CBT Section Styles */
        #selection-section, #quiz-section, #result-section {
            background: #222 !important;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .question-block {
            background: #333 !important;
            color: white !important;
            border: 1px solid #555 !important;
        }

        .option-btn {
            background-color: #444 !important;
            color: white !important;
            border: 1px solid #555 !important;
        }

        .option-btn.selected {
            background-color: #4a7ebB !important;
            color: #fff !important;
        }

        /* Reels grid layout */
        .reel-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .reel-item {
            background: #222 !important;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .reel-caption {
            padding: 12px;
            font-weight: 600;
            text-align: center;
            background: #333 !important;
            color: white !important;
            font-size: 0.95rem;
        }

        /* Mobile-first responsive design */
        @media(max-width: 600px) {
            body {
                font-size: 0.95em;
                padding: 10px;
            }
            header h1 {
                font-size: 1.4em;
            }
            header h3 {
                font-size: 1em;
            }
            .tab {
                padding: 10px 12px;
                font-size: 0.85em;
            }
            .section {
                padding: 12px;
                margin: 10px 0;
            }
        }

        /* Improved button tap targets for mobile */
        button, .tab, #menu-toggle, #theme-toggle {
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Focus states for accessibility */
        button:focus, input:focus, select:focus, .tab:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Animation for section transitions */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section.active {
            animation: fadeIn 0.3s ease-in-out;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        /* Android WebView specific fixes */
        @media screen and (max-width: 768px) {
            body {
                background: #0f2027 !important;
            }
            
            input, button, select {
                font-size: 16px; /* Prevent zoom on focus in iOS */
            }
            
            /* Ensure all text is visible */
            * {
                color: white !important;
            }
        }
    </style>
</head>

<body>

<!-- Theme toggle button -->
<button id="theme-toggle" onclick="toggleMode()">üåô</button>

<div class="auth-status">
  {% if user %}
    <p>Welcome, {{ user.username }}! <a href="/logout">Logout</a></p>
  {% else %}
    <p><a href="/login">Login</a> | <a href="/signup">Sign Up</a></p>
  {% endif %}
</div>

<!-- Sidebar menu toggle -->
<div id="menu-toggle" onclick="toggleMenu()">‚ò∞</div>

<!-- Sidebar menu -->
<div id="side-menu" class="hidden">
  <ul>
    <li><a href="/profile">üë§ Profile</a></li>
    <li><a href="/talk-to-nelavista">üéôÔ∏è Talk To Nelavista</a></li>
     <li><a href="/materials">üìö Materials</a></li>
    <li><a href="/reels">üé• Reels</a></li>
    <li><a href="/CBT">üß† CBT Test</a></li>
    <li><a href="/about">‚ÑπÔ∏è About</a></li>
    <li><a href="/settings">‚öôÔ∏è Settings</a></li>
    <li><a href="/privacy-policy">‚ÑπÔ∏è Privacy Policy</a></li>
  </ul>
</div>

<header>
<h1>üåü Nelavista - Your Educational AI Companion üåü</h1>
<p style="font-size: 16px; color: #ccc; font-weight: 500; margin-top: -4px;">(formerly Tellavista)</p>
<h3>üí° Study smarter, achieve more! üí°</h3>
</header>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-section="aiSection" onclick="activateTab(this)">ü§ñ AI</div>
  <div class="tab" data-section="materialsSection" data-url="/materials" onclick="activateTab(this)">üìö Materials</div>
  <div class="tab" data-section="reelsSection" onclick="activateTab(this)">üé• Reels</div>
  <div class="tab" data-section="cbtSection" onclick="activateTab(this)">üß† CBT</div>
</div>

<!-- AI Section -->
<div class="section active" id="aiSection">
  <div class="messages" id="messages"></div>
  <div class="input-container">
    <input type="text" id="userInput" placeholder="Ask Nelavista about your studies, motivation, or learning tips..." />
    <button id="askButton" onclick="sendQuestion()">Ask</button>
  </div>
</div>

<!-- MATERIALS Section -->
<div class="section" id="materialsSection">
  <h3>üìö Search Course Materials</h3>
  <select id="course">
    <option value="Accountancy">Accountancy</option>
    <option value="Accounting">Accounting</option>
    <option value="Agriculture">Agriculture</option>
    <option value="Arabic Studies">Arabic Studies</option>
    <option value="Banking and Finance">Banking and Finance</option>
    <option value="Biochemistry">Biochemistry</option>
    <option value="Botany">Botany</option>
    <option value="Business Administration">Business Administration</option>
    <option value="Chemical and Polymer Engineering">Chemical and Polymer Engineering</option>
    <option value="Chemistry">Chemistry</option>
    <option value="Christian Religious Studies">Christian Religious Studies</option>
    <option value="Computer Science">Computer Science</option>
    <option value="Dentistry and Dental Surgery">Dentistry and Dental Surgery</option>
    <option value="Drama / Dramatic / Performing Arts">Drama / Dramatic / Performing Arts</option>
    <option value="Early Childhood Education">Early Childhood Education</option>
    <option value="Economics">Economics</option>
    <option value="Education and Accounting">Education and Accounting</option>
    <option value="Education and Biology">Education and Biology</option>
    <option value="Education and Chemistry">Education and Chemistry</option>
    <option value="Education and Christian Religious Studies">Education and Christian Religious Studies</option>
    <option value="Education and Computer Science">Education and Computer Science</option>
    <option value="Education and Economics">Education and Economics</option>
    <option value="Education and English Language">Education and English Language</option>
    <option value="Education and French">Education and French</option>
    <option value="Education and Geography">Education and Geography</option>
    <option value="Education and History">Education and History</option>
    <option value="Education and Islamic Studies">Education and Islamic Studies</option>
    <option value="Education and Mathematics">Education and Mathematics</option>
    <option value="Education and Physics">Education and Physics</option>
    <option value="Education and Political Science">Education and Political Science</option>
    <option value="Education and Yoruba">Education and Yoruba</option>
    <option value="Educational Management">Educational Management</option>
    <option value="Electronics and Computer Engineering">Electronics and Computer Engineering</option>
    <option value="English Language">English Language</option>
    <option value="Fine and Applied Arts">Fine and Applied Arts</option>
    <option value="Fisheries">Fisheries</option>
    <option value="French">French</option>
    <option value="Geography and Planning">Geography and Planning</option>
    <option value="Guidance and Counseling">Guidance and Counseling</option>
    <option value="Health Education">Health Education</option>
    <option value="History and International Studies">History and International Studies</option>
    <option value="Industrial Relations and Personnel Management">Industrial Relations and Personnel Management</option>
    <option value="Insurance">Insurance</option>
    <option value="Islamic Studies">Islamic Studies</option>
    <option value="Law">Law</option>
    <option value="Library and Information Science">Library and Information Science</option>
    <option value="Local Government and Development Studies">Local Government and Development Studies</option>
    <option value="Marketing">Marketing</option>
    <option value="Mass Communication">Mass Communication</option>
    <option value="Mathematics">Mathematics</option>
    <option value="Mechanical Engineering">Mechanical Engineering</option>
    <option value="Medicine and Surgery">Medicine and Surgery</option>
    <option value="Microbiology">Microbiology</option>
    <option value="Music">Music</option>
    <option value="Nursing / Nursing Science">Nursing / Nursing Science</option>
    <option value="Pharmacology">Pharmacology</option>
    <option value="Philosophy">Philosophy</option>
    <option value="Physical and Health Education">Physical and Health Education</option>
    <option value="Physics">Physics</option>
    <option value="Physiology">Physiology</option>
    <option value="Political Science">Political Science</option>
    <option value="Portuguese / English">Portuguese / English</option>
    <option value="Psychology">Psychology</option>
    <option value="Public Administration">Public Administration</option>
    <option value="Sociology">Sociology</option>
    <option value="Teacher Education Science">Teacher Education Science</option>
    <option value="Technology and Vocational Education">Technology and Vocational Education</option>
    <option value="Theatre Arts">Theatre Arts</option>
    <option value="Transport Management Technology">Transport Management Technology</option>
    <option value="Yoruba">Yoruba</option>
    <option value="Zoology">Zoology</option>
  </select>
  <select id="level">
    <option value="">Select Level</option>
    <option value="100">100 Level</option>
    <option value="200">200 Level</option>
    <option value="300">300 Level</option>
  </select>
  <input type="text" id="topic" placeholder="Enter topic (e.g. Calculus, AI, etc)" />
  <button id="searchBtn">üîç Search Materials</button>
  <div id="results"></div>
</div>

<!-- REELS Section -->
<div class="section" id="reelsSection">
  <h3>üé• Educational Reels</h3>
  <select id="reelCourse">
    <option value="">Select Course</option>
    <option value="Accountancy">Accountancy</option>
    <option value="Accounting">Accounting</option>
    <option value="Agriculture">Agriculture</option>
    <option value="Arabic Studies">Arabic Studies</option>
    <option value="Banking and Finance">Banking and Finance</option>
    <option value="Biochemistry">Biochemistry</option>
    <option value="Botany">Botany</option>
    <option value="Business Administration">Business Administration</option>
    <option value="Chemical and Polymer Engineering">Chemical and Polymer Engineering</option>
    <option value="Chemistry">Chemistry</option>
    <option value="Christian Religious Studies">Christian Religious Studies</option>
    <option value="Computer Science">Computer Science</option>
    <option value="Dentistry and Dental Surgery">Dentistry and Dental Surgery</option>
    <option value="Drama / Dramatic / Performing Arts">Drama / Dramatic / Performing Arts</option>
    <option value="Early Childhood Education">Early Childhood Education</option>
    <option value="Economics">Economics</option>
    <option value="Education and Accounting">Education and Accounting</option>
    <option value="Education and Biology">Education and Biology</option>
    <option value="Education and Chemistry">Education and Chemistry</option>
    <option value="Education and Christian Religious Studies">Education and Christian Religious Studies</option>
    <option value="Education and Computer Science">Education and Computer Science</option>
    <option value="Education and Economics">Education and Economics</option>
    <option value="Education and English Language">Education and English Language</option>
    <option value="Education and French">Education and French</option>
    <option value="Education and Geography">Education and Geography</option>
    <option value="Education and History">Education and History</option>
    <option value="Education and Islamic Studies">Education and Islamic Studies</option>
    <option value="Education and Mathematics">Education and Mathematics</option>
    <option value="Education and Physics">Education and Physics</option>
    <option value="Education and Political Science">Education and Political Science</option>
    <option value="Education and Yoruba">Education and Yoruba</option>
    <option value="Educational Management">Educational Management</option>
    <option value="Electronics and Computer Engineering">Electronics and Computer Engineering</option>
    <option value="English Language">English Language</option>
    <option value="Fine and Applied Arts">Fine and Applied Arts</option>
    <option value="Fisheries">Fisheries</option>
    <option value="French">French</option>
    <option value="Geography and Planning">Geography and Planning</option>
    <option value="Guidance and Counseling">Guidance and Counseling</option>
    <option value="Health Education">Health Education</option>
    <option value="History and International Studies">History and International Studies</option>
    <option value="Industrial Relations and Personnel Management">Industrial Relations and Personnel Management</option>
    <option value="Insurance">Insurance</option>
    <option value="Islamic Studies">Islamic Studies</option>
    <option value="Law">Law</option>
    <option value="Library and Information Science">Library and Information Science</option>
    <option value="Local Government and Development Studies">Local Government and Development Studies</option>
    <option value="Marketing">Marketing</option>
    <option value="Mass Communication">Mass Communication</option>
    <option value="Mathematics">Mathematics</option>
    <option value="Mechanical Engineering">Mechanical Engineering</option>
    <option value="Medicine and Surgery">Medicine and Surgery</option>
    <option value="Microbiology">Microbiology</option>
    <option value="Music">Music</option>
    <option value="Nursing / Nursing Science">Nursing / Nursing Science</option>
    <option value="Pharmacology">Pharmacology</option>
    <option value="Philosophy">Philosophy</option>
    <option value="Physical and Health Education">Physical and Health Education</option>
    <option value="Physics">Physics</option>
    <option value="Physiology">Physiology</option>
    <option value="Political Science">Political Science</option>
    <option value="Portuguese / English">Portuguese / English</option>
    <option value="Psychology">Psychology</option>
    <option value="Public Administration">Public Administration</option>
    <option value="Sociology">Sociology</option>
    <option value="Teacher Education Science">Teacher Education Science</option>
    <option value="Technology and Vocational Education">Technology and Vocational Education</option>
    <option value="Theatre Arts">Theatre Arts</option>
    <option value="Transport Management Technology">Transport Management Technology</option>
    <option value="Yoruba">Yoruba</option>
    <option value="Zoology">Zoology</option>
  </select>
  <button onclick="loadReels()">Load Reels</button>
  <div id="reels" class="reel-grid"></div>
</div>

<!-- CBT Section -->
<div class="section" id="cbtSection">
  <div id="selection-section">
    <h2>Select Course & Level</h2>
    <label for="cbt-course">Course:</label>
    <select id="cbt-course">
      <option value="">-- Select Course --</option>
      <option value="Accountancy">Accountancy</option>
      <option value="Accounting">Accounting</option>
      <option value="Agriculture">Agriculture</option>
      <option value="Arabic Studies">Arabic Studies</option>
      <option value="Banking and Finance">Banking and Finance</option>
      <option value="Biochemistry">Biochemistry</option>
      <option value="Botany">Botany</option>
      <option value="Business Administration">Business Administration</option>
      <option value="Chemical and Polymer Engineering">Chemical and Polymer Engineering</option>
      <option value="Chemistry">Chemistry</option>
      <option value="Christian Religious Studies">Christian Religious Studies</option>
      <option value="Computer Science">Computer Science</option>
      <option value="Dentistry and Dental Surgery">Dentistry and Dental Surgery</option>
      <option value="Drama / Dramatic / Performing Arts">Drama / Dramatic / Performing Arts</option>
      <option value="Early Childhood Education">Early Childhood Education</option>
      <option value="Economics">Economics</option>
      <option value="Education and Accounting">Education and Accounting</option>
      <option value="Education and Biology">Education and Biology</option>
      <option value="Education and Chemistry">Education and Chemistry</option>
      <option value="Education and Christian Religious Studies">Education and Christian Religious Studies</option>
      <option value="Education and Computer Science">Education and Computer Science</option>
      <option value="Education and Economics">Education and Economics</option>
      <option value="Education and English Language">Education and English Language</option>
      <option value="Education and French">Education and French</option>
      <option value="Education and Geography">Education and Geography</option>
      <option value="Education and History">Education and History</option>
      <option value="Education and Islamic Studies">Education and Islamic Studies</option>
      <option value="Education and Mathematics">Education and Mathematics</option>
      <option value="Education and Physics">Education and Physics</option>
      <option value="Education and Political Science">Education and Political Science</option>
      <option value="Education and Yoruba">Education and Yoruba</option>
      <option value="Educational Management">Educational Management</option>
      <option value="Electronics and Computer Engineering">Electronics and Computer Engineering</option>
      <option value="English Language">English Language</option>
      <option value="Fine and Applied Arts">Fine and Applied Arts</option>
      <option value="Fisheries">Fisheries</option>
      <option value="French">French</option>
      <option value="Geography and Planning">Geography and Planning</option>
      <option value="Guidance and Counseling">Guidance and Counseling</option>
      <option value="Health Education">Health Education</option>
      <option value="History and International Studies">History and International Studies</option>
      <option value="Industrial Relations and Personnel Management">Industrial Relations and Personnel Management</option>
      <option value="Insurance">Insurance</option>
      <option value="Islamic Studies">Islamic Studies</option>
      <option value="Law">Law</option>
      <option value="Library and Information Science">Library and Information Science</option>
      <option value="Local Government and Development Studies">Local Government and Development Studies</option>
      <option value="Marketing">Marketing</option>
      <option value="Mass Communication">Mass Communication</option>
      <option value="Mathematics">Mathematics</option>
      <option value="Mechanical Engineering">Mechanical Engineering</option>
      <option value="Medicine and Surgery">Medicine and Surgery</option>
      <option value="Microbiology">Microbiology</option>
      <option value="Music">Music</option>
      <option value="Nursing / Nursing Science">Nursing / Nursing Science</option>
      <option value="Pharmacology">Pharmacology</option>
      <option value="Philosophy">Philosophy</option>
      <option value="Physical and Health Education">Physical and Health Education</option>
      <option value="Physics">Physics</option>
      <option value="Physiology">Physiology</option>
      <option value="Political Science">Political Science</option>
      <option value="Portuguese / English">Portuguese / English</option>
      <option value="Psychology">Psychology</option>
      <option value="Public Administration">Public Administration</option>
      <option value="Sociology">Sociology</option>
      <option value="Teacher Education Science">Teacher Education Science</option>
      <option value="Technology and Vocational Education">Technology and Vocational Education</option>
      <option value="Theatre Arts">Theatre Arts</option>
      <option value="Transport Management Technology">Transport Management Technology</option>
      <option value="Yoruba">Yoruba</option>
      <option value="Zoology">Zoology</option>
    </select>
    <br>
    <label for="cbt-level">Level:</label>
    <select id="cbt-level">
      <option value="">-- Select Level --</option>
      <option>100</option>
      <option>200</option>
      <option>300</option>
      <option>400</option>
    </select>
    <br>
    <button onclick="startQuiz()">Start Test</button>
  </div>

  <div id="quiz-section" style="display:none">
    <h2 id="quiz-title"></h2>
    <form id="quiz-form">
    </form>
    <button onclick="submitQuiz()">Submit</button>
  </div>

  <div id="result-section" style="display:none">
    <h2>Your Result</h2>
    <p id="score-text"></p>
    <button onclick="restartQuiz()">Try Another</button>
  </div>
</div>

<script>
// Theme toggle logic
const themeBtn = document.getElementById('theme-toggle');
// Force dark mode for Android WebView
document.body.style.backgroundColor = '#0f2027';
themeBtn.innerText = 'üåô';

function toggleMode() {
  // Keep dark mode as default for Android compatibility
  themeBtn.innerText = 'üåô';
}

// Sidebar menu toggle
function toggleMenu() {
  document.getElementById('side-menu').classList.toggle('hidden');
}

// TAB SWITCHING
function activateTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(tab.dataset.section).classList.add('active');
}

// AI CHAT
const chatHistory = [];
function sendQuestion() {
  const input = document.getElementById("userInput");
  const msgBox = document.getElementById("messages");
  const question = input.value.trim();
  
  if (!question) return;
  
  // Show user message
  const userMsg = document.createElement('p');
  userMsg.className = 'user-message';
  userMsg.innerText = `You: ${question}`;
  msgBox.appendChild(userMsg);
  input.value = '';
  msgBox.scrollTop = msgBox.scrollHeight;

  // Add to chat history
  chatHistory.push({ role: 'user', content: question });

  // Show loading
  const loadingMsg = document.createElement('p');
  loadingMsg.className = 'ai-message';
  loadingMsg.innerText = 'Nelavista is thinking...';
  msgBox.appendChild(loadingMsg);
  msgBox.scrollTop = msgBox.scrollHeight;

  fetch('/ask', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ history: chatHistory })
  }).then(res => res.json())
    .then(data => {
      loadingMsg.remove();
      const answer = data.choices?.[0]?.message?.content || "Sorry, I couldn't answer.";
      chatHistory.push({ role: 'assistant', content: answer });
      const aiMsg = document.createElement('p');
      aiMsg.className = 'ai-message';
      aiMsg.innerHTML = `<strong>Nelavista:</strong> ${answer}`;
      msgBox.appendChild(aiMsg);
      msgBox.scrollTop = msgBox.scrollHeight;
    })
    .catch(() => {
      loadingMsg.remove();
      const errorMsg = document.createElement('p');
      errorMsg.className = 'ai-message';
      errorMsg.innerText = 'Error reaching Nelavista. Please try again.';
      msgBox.appendChild(errorMsg);
      msgBox.scrollTop = msgBox.scrollHeight;
    });
}

// MATERIALS SEARCH
document.getElementById('searchBtn').addEventListener('click', () => {
  const course = document.getElementById('course').value;
  const level = document.getElementById('level').value;
  const topic = document.getElementById('topic').value.trim();
  const btn = document.getElementById('searchBtn');

  if (!course || !level || !topic) {
    alert("Please select course, level, and enter topic.");
    return;
  }

  btn.textContent = "üîç Searching...";
  btn.disabled = true;

  fetch(`/ai/materials?topic=${encodeURIComponent(topic)}&level=${encodeURIComponent(level)}&department=${encodeURIComponent(course)}`)
    .then(res => res.json())
    .then(data => {
      btn.textContent = "üîç Search Materials";
      btn.disabled = false;
      const container = document.getElementById('results');
      container.innerHTML = '';

      if (data.books && data.books.length > 0) {
        container.innerHTML += `<h4 style="color: white;">üìñ Books</h4>`;
        data.books.forEach(book => {
          container.innerHTML += `<div style="color: white;"><b>${book.title}</b> - ${book.author} <a href="${book.link}" target="_blank" style="color: #00cba9;">Read</a></div>`;
        });
      }

      if (data.videos && data.videos.length > 0) {
        container.innerHTML += `<h4 style="color: white;">üé• Videos</h4>`;
        data.videos.forEach(video => {
          container.innerHTML += `<div style="color: white;"><a href="${video.link}" target="_blank" style="color: #00cba9;">${video.title}</a></div>`;
        });
      }

      if ((!data.books || !data.books.length) && (!data.videos || !data.videos.length)) {
        container.innerHTML = "<p style='color: white;'>No materials found for this course.</p>";
      }
    })
    .catch(err => {
      document.getElementById('results').innerHTML = "<p style='color: white;'>‚ùå Error loading materials.</p>";
      console.error(err);
      btn.textContent = "üîç Search Materials";
      btn.disabled = false;
    });
});

// REELS SECTION
const educationalReels = [
  // Accountancy
  {"course": "Accountancy", "caption": "Financial Statements Basics", "video_url": "https://youtu.be/fb7YCVR5fIU?si=XWozkxGoBV2HP2HW"},
  {"course": "Accountancy", "caption": "Management Accounting Overview", "video_url": "https://youtu.be/qISkyoiGHcI?si=BKRnkFfl-fqKXgLG"},
  {"course": "Accountancy", "caption": "Auditing Principles", "video_url": "https://youtu.be/27gabbJQZqc?si=rsOLmkD2QXOoxSoi"},
  {"course": "Accountancy", "caption": "Taxation Fundamentals", "video_url": "https://youtu.be/Cox8rLXYAGQ?si=CvKUaPuPJOxPb6cr"},
  {"course": "Accountancy", "caption": "Learn Accounting in under 5 hours", "video_url": "https://youtu.be/gPBhGkBN30s?si=bUYfaccZPlBni3aZ"},
];

function isYouTube(url) {
  return url.includes("youtube.com") || url.includes("youtu.be");
}

function getYouTubeEmbed(url) {
  const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([\w-]+)/);
  const videoId = match ? match[1] : null;
  return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
}

async function loadReels() {
  const course = document.getElementById("reelCourse").value;
  const reelBox = document.getElementById("reels");
  reelBox.innerHTML = "‚è≥ Loading...";

  if (!course) {
    reelBox.innerHTML = "‚ùå Please select a course.";
    return;
  }

  try {
    // Filter reels by selected course
    const filteredReels = educationalReels.filter(reel => reel.course === course);
    
    reelBox.innerHTML = "";

    if (filteredReels.length > 0) {
      filteredReels.forEach(reel => {
        const embed = isYouTube(reel.video_url)
          ? `<iframe src="${getYouTubeEmbed(reel.video_url)}" allowfullscreen></iframe>`
          : `<video controls src="${reel.video_url}"></video>`;
        
        const reelItem = document.createElement('div');
        reelItem.className = 'reel-item';
        reelItem.innerHTML = `
          ${embed}
          <div class="reel-caption">${reel.caption}</div>
        `;
        reelBox.appendChild(reelItem);
      });
    } else {
      reelBox.innerHTML = "üòï No reels found for this course.";
    }
  } catch (err) {
    console.error(err);
    reelBox.innerHTML = "‚ùå Error loading reels.";
  }
}

// CBT SECTION
const allQuestions = {
  "Accountancy": {
    "100": [
      { q: "What is a common concept in Accountancy - Level 100?", o: ["Double-entry bookkeeping", "Accrual basis", "Matching principle", "Conservatism"], a: 0 },
      { q: "Identify a key principle in Accountancy - Level 100?", o: ["Consistency", "Materiality", "Prudence", "Relevance"], a: 1 },
      { q: "Which financial statement shows the company's financial position at a specific point in time?", o: ["Income Statement", "Balance Sheet", "Cash Flow Statement", "Statement of Changes in Equity"], a: 1 }
    ],
    "200": [
      { q: "What is the purpose of adjusting entries in accounting?", o: ["To correct errors", "To update account balances before financial statements", "To record new transactions", "To close accounts"], a: 1 },
      { q: "Which method is used to allocate the cost of an intangible asset over its useful life?", o: ["Amortization", "Depreciation", "Depletion", "Impairment"], a: 0 },
      { q: "What does 'depreciation' refer to?", o: ["Increase in asset value", "Allocation of asset cost over time", "Loss of asset due to damage", "Sale of asset"], a: 1 }
    ],
    "300": [
      { q: "What is the primary purpose of consolidating financial statements?", o: ["To combine parent and subsidiary companies", "To prepare tax returns", "To analyze cash flows", "To report on individual departments"], a: 0 },
      { q: "Which accounting standard governs revenue recognition?", o: ["IFRS 15", "IAS 2", "GAAP 101", "FASB 606"], a: 0 },
      { q: "What is the process of transferring costs from work-in-progress to finished goods called?", o: ["Costing", "Production transfer", "Manufacturing overhead allocation", "Work transfer"], a: 0 }
    ]
  }
};

function startQuiz() {
  const course = document.getElementById("cbt-course").value;
  const level = document.getElementById("cbt-level").value;
  if (!course || !level) return alert("Please select both course and level");

  const questions = allQuestions[course]?.[level];
  if (!questions) return alert("No questions available for this selection!");

  document.getElementById("selection-section").style.display = "none";
  document.getElementById("quiz-section").style.display = "block";
  document.getElementById("result-section").style.display = "none";
  document.getElementById("quiz-title").innerText = `${course} - ${level} Level CBT`;

  const form = document.getElementById("quiz-form");
  form.innerHTML = "";

  questions.forEach((q, i) => {
    const block = document.createElement("div");
    block.className = "question-block";
    block.innerHTML = `<div class="question-text">${i+1}. ${q.q}</div>`;
    q.o.forEach((opt, j) => {
      block.innerHTML += `
        <label style="color: white; display: block; padding: 10px; margin: 5px 0; background: #333; border-radius: 8px;">
          <input name="q${i}" type="radio" value="${j}" style="margin-right: 10px;" />
          <span>${opt}</span>
        </label>`;
    });
    form.appendChild(block);
  });
}

function submitQuiz() {
  const course = document.getElementById("cbt-course").value;
  const level = document.getElementById("cbt-level").value;
  const questions = allQuestions[course][level];
  const form = document.getElementById("quiz-form");

  let correct = 0;
  questions.forEach((q, i) => {
    const selected = form[`q${i}`];
    let answer = -1;
    for (let j = 0; j < selected.length; j++) {
      if (selected[j].checked) {
        answer = parseInt(selected[j].value);
        break;
      }
    }
    if (answer === q.a) correct++;
  });

  const total = questions.length;
  document.getElementById("quiz-section").style.display = "none";
  document.getElementById("result-section").style.display = "block";
  document.getElementById("score-text").innerText = `You scored ${correct} out of ${total} (${Math.round((correct/total)*100)}%)`;
}

function restartQuiz() {
  document.getElementById("selection-section").style.display = "block";
  document.getElementById("quiz-section").style.display = "none";
  document.getElementById("result-section").style.display = "none";
  document.getElementById("cbt-course").value = "";
  document.getElementById("cbt-level").value = "";
}

// Initialize on load
document.addEventListener('DOMContentLoaded', function() {
  // Add enter key support for AI chat
  document.getElementById('userInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      sendQuestion();
    }
  });
  
  // Force dark mode styling
  document.querySelectorAll('*').forEach(el => {
    if (!el.style.backgroundColor && el.tagName !== 'BODY') {
      el.style.color = 'white';
    }
  });
});
</script>
</body>
</html>
