<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nelavista ‚Ä¢ Document Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Markdown rendering -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    
    <!-- MathJax for LaTeX rendering -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          displayMath: [['$$', '$$'], ['\\[', '\\]']]
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
        },
        svg: { fontCache: 'global' }
      };
    </script>
    <script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

    <style>
/* ===== CSS VARIABLES & RESET ===== */
:root {
  --primary-color: #000000;
  --primary-dark: #333333;
  --light-bg: #ffffff;
  --dark-bg: #000000;
  --card-light: #ffffff;
  --card-dark: #0a0a0a;
  --text-light: #000000;
  --text-dark: #ffffff;
  --sidebar-dark: #000000;
  --overlay-dark: rgba(0, 0, 0, 0.7);
  --user-msg-bg: #1a1a1a;
  --ai-msg-bg: #0a0a0a;
  --input-bg: #0a0a0a;
  --gradient-start: #ffffff;
  --gradient-end: #888888;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
}

body {
  background: var(--dark-bg);
  color: var(--text-dark);
  min-height: 100vh;
  transition: background 0.3s, color 0.3s;
  overflow-x: hidden;
}

body.light-mode {
  background: var(--light-bg);
  color: var(--text-light);
}

/* ===== TOP BAR (Updated with proper z-index) ===== */
#top-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 60px;
  background: rgba(0, 0, 0, 0.95);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 16px;
  z-index: 1002;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

body.light-mode #top-bar {
  background: rgba(255, 255, 255, 0.95);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

#menu-toggle,
#theme-toggle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 20px;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: white;
  transition: background 0.2s;
}

body.light-mode #menu-toggle,
body.light-mode #theme-toggle {
  background: rgba(0, 0, 0, 0.05);
  color: #000;
}

#menu-toggle:hover,
#theme-toggle:hover {
  background: rgba(255, 255, 255, 0.2);
}

body.light-mode #menu-toggle:hover,
body.light-mode #theme-toggle:hover {
  background: rgba(0, 0, 0, 0.1);
}

/* ===== SIDEBAR MENU ===== */
#side-menu {
  position: fixed;
  top: 0;
  left: -260px;
  width: 260px;
  height: 100%;
  background: var(--sidebar-dark);
  transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1003;
  overflow-y: auto;
  padding-top: 70px;
  border-right: 1px solid rgba(255, 255, 255, 0.1);
}

#side-menu.active {
  left: 0;
}

#side-menu ul {
  list-style: none;
}

#side-menu li {
  padding: 0;
}

#side-menu a {
  display: flex;
  align-items: center;
  padding: 14px 20px;
  color: var(--text-dark);
  text-decoration: none;
  font-size: 15px;
  transition: background 0.2s;
  border-left: 1px solid transparent;
}

#side-menu a:hover {
  background: rgba(255, 255, 255, 0.1);
  border-left-color: rgba(255, 255, 255, 0.5);
}

#side-menu a::before {
  content: '';
  display: inline-block;
  margin-right: 12px;
  font-size: 18px;
}

/* Icon mapping for menu items */
#side-menu a[href*="profile"]::before { content: 'üë§'; }
#side-menu a[href*="talk"]::before { content: 'ü§ñ'; }
#side-menu a[href*="live"]::before { content: 'üì°'; }
#side-menu a[href*="campus-map"]::before { content: 'üó∫Ô∏è'; }
#side-menu a[href*="materials"]::before { content: 'üìö'; }
#side-menu a[href*="analyze"]::before { content: 'üìä'; }
#side-menu a[href*="reels"]::before { content: 'üé¨'; }
#side-menu a[href*="CBT"]::before { content: 'üìù'; }
#side-menu a[href*="about"]::before { content: '‚ÑπÔ∏è'; }
#side-menu a[href*="settings"]::before { content: '‚öôÔ∏è'; }
#side-menu a[href*="privacy"]::before { content: 'üîí'; }
#side-menu a[href*="logout"]::before { content: 'üö™'; }

/* ===== OVERLAY ===== */
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--overlay-dark);
  display: none;
  z-index: 1002;
  backdrop-filter: blur(2px);
  cursor: pointer;
}

#overlay.active {
  display: block;
}

/* ===== DOCUMENT ANALYZER STYLES ===== */
.container {
  max-width: 1000px;
  margin: 80px auto 40px;
  padding: 20px;
  min-height: calc(100vh - 120px);
  display: flex;
  flex-direction: column;
}

/* Header */
.header {
  text-align: center;
  padding: 40px 0 60px;
}

.logo {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 16px;
  background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

body.light-mode .logo {
  background: linear-gradient(135deg, var(--text-light), var(--gradient-end));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.logo i {
  color: var(--text-dark);
  font-size: 2rem;
}

body.light-mode .logo i {
  color: var(--text-light);
}

.tagline {
  color: #a0a0a0;
  font-size: 1.2rem;
  font-weight: 400;
  letter-spacing: 0.01em;
}

body.light-mode .tagline {
  color: #666;
}

/* Upload Interface */
.upload-interface {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.options-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 60px;
}

@media (max-width: 768px) {
  .options-grid {
    grid-template-columns: 1fr;
  }
}

.option-card {
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 24px;
  padding: 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

body.light-mode .option-card {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.option-card:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-4px);
}

body.light-mode .option-card:hover {
  background: rgba(0, 0, 0, 0.1);
  border-color: rgba(0, 0, 0, 0.2);
}

.option-icon {
  width: 80px;
  height: 80px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-dark);
}

body.light-mode .option-icon {
  background: rgba(0, 0, 0, 0.1);
  color: var(--text-light);
}

.option-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.option-card h2 {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-dark);
  border: none;
  margin: 0;
  padding: 0;
}

body.light-mode .option-card h2 {
  color: var(--text-light);
}

.option-card p {
  font-size: 1rem;
  color: #a0a0a0;
  line-height: 1.5;
  margin: 0;
}

body.light-mode .option-card p {
  color: #666;
}

/* Upload Area */
.upload-area {
  display: none;
  background: rgba(255, 255, 255, 0.08);
  border: 2px dashed rgba(255, 255, 255, 0.2);
  border-radius: 24px;
  padding: 60px 40px;
  text-align: center;
  transition: all 0.3s ease;
}

body.light-mode .upload-area {
  background: rgba(0, 0, 0, 0.05);
  border: 2px dashed rgba(0, 0, 0, 0.2);
}

.upload-area.active {
  display: block;
}

.upload-area:hover {
  border-color: rgba(255, 255, 255, 0.4);
  background: rgba(255, 255, 255, 0.12);
}

body.light-mode .upload-area:hover {
  border-color: rgba(0, 0, 0, 0.4);
  background: rgba(0, 0, 0, 0.08);
}

.upload-area i {
  font-size: 4rem;
  color: var(--text-dark);
  margin-bottom: 20px;
  opacity: 0.8;
}

body.light-mode .upload-area i {
  color: var(--text-light);
}

.upload-area h3 {
  font-size: 1.75rem;
  margin-bottom: 10px;
  font-weight: 600;
  border: none;
  margin-top: 0;
  color: var(--text-dark);
}

body.light-mode .upload-area h3 {
  color: var(--text-light);
}

.upload-area p {
  color: #a0a0a0;
  font-size: 1.1rem;
  margin-bottom: 40px;
}

body.light-mode .upload-area p {
  color: #666;
}

.file-input-wrapper {
  display: inline-block;
  position: relative;
}

.btn-upload {
  background: var(--primary-color);
  color: white;
  padding: 16px 32px;
  font-size: 1.1rem;
  font-weight: 500;
  border-radius: 24px;
  border: none;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

.btn-upload:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.btn-upload:active {
  transform: translateY(0);
}

#fileInput {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  opacity: 0;
  cursor: pointer;
}

/* Upload Status */
.upload-status {
  display: none;
  background: rgba(255, 255, 255, 0.08);
  border-radius: 24px;
  padding: 30px;
  margin-bottom: 30px;
  border: 1px solid rgba(255, 255, 255, 0.12);
}

body.light-mode .upload-status {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.upload-status.active {
  display: flex;
  align-items: center;
  gap: 20px;
}

.status-icon {
  width: 70px;
  height: 70px;
  border-radius: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  background: rgba(255, 255, 255, 0.1);
  color: var(--text-dark);
}

body.light-mode .status-icon {
  background: rgba(0, 0, 0, 0.1);
  color: var(--text-light);
}

.status-content {
  flex: 1;
}

.status-content h3 {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 5px;
  border: none;
  margin-top: 0;
  color: var(--text-dark);
}

body.light-mode .status-content h3 {
  color: var(--text-light);
}

.status-content p {
  color: #a0a0a0;
  font-size: 0.95rem;
  margin: 0;
}

body.light-mode .status-content p {
  color: #666;
}

.status-loading {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}

.loading-spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-top-color: var(--text-dark);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

body.light-mode .loading-spinner {
  border: 3px solid rgba(0, 0, 0, 0.1);
  border-top-color: var(--text-light);
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Analysis Results */
.analysis-results {
  display: none;
}

.analysis-results.active {
  display: block;
  animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.results-header {
  text-align: center;
  margin-bottom: 40px;
  padding-bottom: 20px;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

body.light-mode .results-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.results-header h2 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 10px;
  color: var(--text-dark);
  border: none;
}

body.light-mode .results-header h2 {
  color: var(--text-light);
}

.document-title {
  font-size: 1.1rem;
  color: #a0a0a0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

body.light-mode .document-title {
  color: #666;
}

/* Notes Container */
.notes-container {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 24px;
  padding: 40px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  margin-bottom: 40px;
}

body.light-mode .notes-container {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

/* Markdown Content Styling */
.markdown-body {
  font-size: 1.1rem;
  line-height: 1.8;
  color: var(--text-dark);
  background: transparent;
}

body.light-mode .markdown-body {
  color: var(--text-light);
}

.markdown-body h1 {
  font-size: 2rem;
  margin-bottom: 30px;
  padding-bottom: 15px;
  border-bottom: 2px solid rgba(255, 255, 255, 0.1);
  color: var(--text-dark);
}

body.light-mode .markdown-body h1 {
  border-bottom: 2px solid rgba(0, 0, 0, 0.1);
  color: var(--text-light);
}

.markdown-body h2 {
  font-size: 1.75rem;
  margin: 40px 0 20px;
  color: var(--text-dark);
  border: none;
}

body.light-mode .markdown-body h2 {
  color: var(--text-light);
}

.markdown-body h3 {
  font-size: 1.5rem;
  margin: 30px 0 15px;
  color: var(--text-dark);
}

body.light-mode .markdown-body h3 {
  color: var(--text-light);
}

.markdown-body p {
  margin-bottom: 20px;
  line-height: 1.8;
  color: rgba(255, 255, 255, 0.9);
}

body.light-mode .markdown-body p {
  color: rgba(0, 0, 0, 0.9);
}

.markdown-body ul, .markdown-body ol {
  margin-bottom: 20px;
  padding-left: 40px;
}

.markdown-body li {
  margin-bottom: 10px;
  line-height: 1.8;
  color: rgba(255, 255, 255, 0.9);
}

body.light-mode .markdown-body li {
  color: rgba(0, 0, 0, 0.9);
}

.markdown-body blockquote {
  border-left: 4px solid rgba(255, 255, 255, 0.2);
  padding-left: 20px;
  margin: 25px 0;
  color: rgba(255, 255, 255, 0.8);
  font-style: italic;
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 12px;
}

body.light-mode .markdown-body blockquote {
  border-left: 4px solid rgba(0, 0, 0, 0.2);
  color: rgba(0, 0, 0, 0.8);
  background: rgba(0, 0, 0, 0.03);
}

.markdown-body code {
  background: rgba(255, 255, 255, 0.1);
  padding: 4px 8px;
  border-radius: 6px;
  font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  font-size: 0.9em;
  color: var(--text-dark);
}

body.light-mode .markdown-body code {
  background: rgba(0, 0, 0, 0.1);
  color: var(--text-light);
}

.markdown-body pre {
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 12px;
  overflow-x: auto;
  margin: 25px 0;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

body.light-mode .markdown-body pre {
  background: rgba(0, 0, 0, 0.05);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.markdown-body pre code {
  background: none;
  padding: 0;
  color: rgba(255, 255, 255, 0.9);
}

body.light-mode .markdown-body pre code {
  color: rgba(0, 0, 0, 0.9);
}

.notes-actions {
  display: flex;
  gap: 10px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.btn-action {
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.8);
  padding: 12px 24px;
  border-radius: 24px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 10px;
}

body.light-mode .btn-action {
  background: rgba(0, 0, 0, 0.05);
  color: rgba(0, 0, 0, 0.8);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.btn-action:hover {
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

body.light-mode .btn-action:hover {
  background: rgba(0, 0, 0, 0.1);
  border-color: rgba(0, 0, 0, 0.2);
}

.btn-action.active {
  background: var(--primary-color);
  border-color: var(--primary-color);
  color: white;
}

/* Error Message */
.error-message {
  display: none;
  background: rgba(248, 81, 73, 0.1);
  border-left: 4px solid #f85149;
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 30px;
  color: #f85149;
  font-size: 0.95rem;
  line-height: 1.5;
}

.error-message.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

.error-message i {
  margin-right: 10px;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 60px 40px;
  color: #a0a0a0;
}

body.light-mode .empty-state {
  color: #666;
}

.empty-state i {
  font-size: 4rem;
  margin-bottom: 20px;
  opacity: 0.3;
}

.empty-state h3 {
  font-size: 1.5rem;
  margin-bottom: 10px;
  color: var(--text-dark);
  border: none;
}

body.light-mode .empty-state h3 {
  color: var(--text-light);
}

.empty-state p {
  font-size: 1rem;
  max-width: 400px;
  margin: 0 auto;
}

/* Footer */
.footer {
  text-align: center;
  padding: 60px 0 30px;
  color: #a0a0a0;
  font-size: 0.9rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  margin-top: 60px;
}

body.light-mode .footer {
  color: #666;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

/* Scroll to Top Button */
.scroll-to-top {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  background: var(--primary-color);
  color: white;
  border-radius: 50%;
  display: none;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 1000;
  border: none;
  font-size: 1.2rem;
}

.scroll-to-top:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar {
  width: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 3px;
  transition: background 0.3s ease;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.2);
}

body.light-mode ::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.1);
}

body.light-mode ::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.2);
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
  .container {
    padding: 16px;
    margin-top: 70px;
  }

  .header {
    padding: 30px 0 40px;
  }

  .logo {
    font-size: 2rem;
  }

  .tagline {
    font-size: 1.1rem;
  }

  .option-card {
    padding: 24px;
  }

  .option-icon {
    width: 70px;
    height: 70px;
    font-size: 1.75rem;
  }

  .upload-area {
    padding: 40px 20px;
  }

  .upload-area i {
    font-size: 3rem;
  }

  .upload-status.active {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }

  .notes-container {
    padding: 24px;
  }

  .markdown-body h1 {
    font-size: 1.75rem;
  }

  .markdown-body h2 {
    font-size: 1.5rem;
  }

  .markdown-body h3 {
    font-size: 1.25rem;
  }

  .notes-actions {
    flex-direction: column;
  }

  .btn-action {
    width: 100%;
    justify-content: center;
  }

  .scroll-to-top {
    bottom: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
  }
}

@media (max-width: 480px) {
  .logo {
    font-size: 1.75rem;
  }
  
  .tagline {
    font-size: 1rem;
  }
  
  .option-card {
    padding: 20px;
  }
  
  .upload-area {
    padding: 30px 16px;
  }
  
  .btn-upload {
    padding: 14px 24px;
    font-size: 1rem;
  }
  
  .markdown-body {
    font-size: 1rem;
  }
}

/* ===== UTILITY CLASSES ===== */
.hidden {
  display: none !important;
}

.show {
  display: block !important;
}

.flex-show {
  display: flex !important;
}
    </style>
</head>
<body class="dark-mode">

<!-- TOP BAR -->
<div id="top-bar">
  <button id="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
  <button id="theme-toggle" onclick="toggleTheme()">üåô</button>
</div>

<!-- SIDEBAR -->
<div id="side-menu">
  <ul>
    <li><a href="/campus-map">Lasu Map</a></li>
    <li><a href="/profile">Profile</a></li>
    <li><a href="/talk-to-nelavista">Talk to Nelavista</a></li>
    <li><a href="/analyze">Analyze Materials</a></li>
    <li><a href="/live-meeting">Live Meeting</a></li>
    <li><a href="/materials">Study Materials</a></li>
    <li><a href="/reels">Reels</a></li>
    <li><a href="/CBT">CBT Test</a></li>
    <li><a href="/about">About</a></li>
    <li><a href="/settings">Settings</a></li>
    <li><a href="/privacy-policy">Privacy Policy</a></li>
    <li><a href="/logout">Logout</a></li>
  </ul>
</div>

<!-- OVERLAY for closing menu -->
<div id="overlay" onclick="closeMenu()"></div>

<!-- Main Content Container -->
<div class="container">
    <!-- Header -->
    <div class="header">
        <div class="logo">
            <i class="fas fa-bolt"></i>
            <span>Nelavista</span>
        </div>
        <p class="tagline">Academic Document Analyzer</p>
    </div>

    <!-- Main Content -->
    <div class="upload-interface">
        <!-- Initial Options -->
        <div class="options-grid" id="initialOptions">
            <div class="option-card" id="uploadOption">
                <div class="option-icon">
                    <i class="fas fa-file-upload"></i>
                </div>
                <div class="option-content">
                    <h2>Upload PDF</h2>
                    <p>Upload any academic PDF for AI-powered study notes</p>
                </div>
            </div>
            
            <div class="option-card" id="notesOption">
                <div class="option-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="option-content">
                    <h2>Lecture Notes</h2>
                    <p>Generate exam-ready notes from your documents</p>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <i class="fas fa-exclamation-circle"></i>
            <span id="errorText">An error occurred during analysis</span>
        </div>

        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Upload Academic PDF</h3>
            <p>Upload any PDF document (lecture slides, textbooks, papers)</p>
            <div class="file-input-wrapper">
                <button class="btn-upload" id="uploadButton">
                    <i class="fas fa-folder-open"></i>
                    Choose PDF File
                </button>
                <input type="file" id="fileInput" accept=".pdf">
            </div>
        </div>

        <!-- Upload Status -->
        <div class="upload-status" id="uploadStatus">
            <div class="status-icon">
                <i class="far fa-file-pdf"></i>
            </div>
            <div class="status-content">
                <h3>Processing PDF</h3>
                <p id="fileName">document.pdf</p>
                <div class="status-loading">
                    <div class="loading-spinner"></div>
                    <span id="loadingText">Analyzing document structure...</span>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div class="analysis-results" id="analysisResults">
            <div class="results-header">
                <h2 id="resultsTitle">Study Notes</h2>
                <div class="document-title">
                    <i class="far fa-file-alt"></i>
                    <span id="resultFileName">document.pdf</span>
                </div>
            </div>

            <!-- Notes Actions -->
            <div class="notes-actions" id="notesActions">
                <button class="btn-action active" data-section="notes">
                    <i class="fas fa-graduation-cap"></i> Study Notes
                </button>
                <button class="btn-action" data-section="summary">
                    <i class="fas fa-file-alt"></i> Quick Summary
                </button>
                <button class="btn-action" data-section="topics">
                    <i class="fas fa-tags"></i> Key Topics
                </button>
                <button class="btn-action" id="downloadButton">
                    <i class="fas fa-download"></i> Download Notes
                </button>
                <button class="btn-action" id="clearButton">
                    <i class="fas fa-trash-alt"></i> Clear
                </button>
            </div>

            <!-- Notes Content -->
            <div class="notes-container" id="notesContainer">
                <div class="markdown-body" id="notesContent">
                    <!-- Full notes will be rendered here -->
                </div>
                
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-file-alt"></i>
                    <h3>No Document Analyzed</h3>
                    <p>Upload a PDF to generate AI-powered study notes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p>Nelavista ‚Ä¢ Intelligent Academic Notes Generator</p>
        <p>Transform PDFs into exam-ready study materials</p>
    </div>

    <!-- Scroll to Top Button -->
    <div class="scroll-to-top" id="scrollToTop">
        <i class="fas fa-arrow-up"></i>
    </div>
</div>

<!-- Markdown Parser -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- File Saver -->
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
    // ===== GLOBAL STATE =====
    const state = {
        theme: localStorage.getItem('theme') || 'dark',
        currentFile: null,
        currentNotes: null,
        currentSection: 'notes'
    };

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
        initializeTheme();
        setupEventListeners();
        setupDragAndDrop();
    });

    function initializeTheme() {
        if (state.theme === 'dark') {
            document.body.classList.add('dark-mode');
            document.getElementById('theme-toggle').textContent = 'üåô';
        } else {
            document.body.classList.add('light-mode');
            document.getElementById('theme-toggle').textContent = '‚òÄÔ∏è';
        }
    }

    function setupEventListeners() {
        // Option card click handlers
        const uploadOption = document.getElementById('uploadOption');
        const notesOption = document.getElementById('notesOption');
        
        if (uploadOption) {
            uploadOption.addEventListener('click', showUploadArea);
        }
        if (notesOption) {
            notesOption.addEventListener('click', showUploadArea);
        }

        // File input handling
        const fileInput = document.getElementById('fileInput');
        if (fileInput) {
            fileInput.addEventListener('change', handleFileSelect);
        }

        // Upload button to trigger file input
        const uploadButton = document.getElementById('uploadButton');
        if (uploadButton) {
            uploadButton.addEventListener('click', () => {
                if (fileInput) {
                    fileInput.click();
                }
            });
        }

        // Download button
        const downloadButton = document.getElementById('downloadButton');
        if (downloadButton) {
            downloadButton.addEventListener('click', downloadNotes);
        }

        // Clear button
        const clearButton = document.getElementById('clearButton');
        if (clearButton) {
            clearButton.addEventListener('click', clearAnalysis);
        }

        // Section buttons
        const notesActions = document.querySelectorAll('.btn-action[data-section]');
        if (notesActions) {
            notesActions.forEach(button => {
                button.addEventListener('click', (e) => {
                    const section = e.currentTarget.getAttribute('data-section');
                    if (section) {
                        showSection(section, e.currentTarget);
                    }
                });
            });
        }

        // Scroll to top button
        const scrollToTopBtn = document.getElementById('scrollToTop');
        if (scrollToTopBtn) {
            scrollToTopBtn.addEventListener('click', scrollToTop);
        }

        // Scroll event for scroll-to-top button
        window.addEventListener('scroll', () => {
            if (scrollToTopBtn) {
                scrollToTopBtn.style.display = window.pageYOffset > 300 ? 'flex' : 'none';
            }
        });
    }

    // ===== THEME TOGGLE =====
    function toggleTheme() {
        const themeBtn = document.getElementById('theme-toggle');
        
        if (document.body.classList.contains('dark-mode')) {
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
            themeBtn.textContent = '‚òÄÔ∏è';
            state.theme = 'light';
        } else {
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            themeBtn.textContent = 'üåô';
            state.theme = 'dark';
        }
        
        localStorage.setItem('theme', state.theme);
    }

    // ===== SIDEBAR MENU FUNCTIONS =====
    function toggleMenu() {
        const sideMenu = document.getElementById('side-menu');
        const overlay = document.getElementById('overlay');
        
        sideMenu.classList.toggle('active');
        overlay.classList.toggle('active');
        
        if (sideMenu.classList.contains('active')) {
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = '';
        }
    }

    function closeMenu() {
        document.getElementById('side-menu').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
        document.body.style.overflow = '';
    }

    // ===== UPLOAD AREA =====
    function showUploadArea() {
        hideError();
        const initialOptions = document.getElementById('initialOptions');
        const uploadArea = document.getElementById('uploadArea');
        const analysisResults = document.getElementById('analysisResults');
        
        if (initialOptions && uploadArea) {
            initialOptions.classList.add('hidden');
            uploadArea.classList.add('active');
            if (analysisResults) {
                analysisResults.classList.remove('active');
            }
        }
    }

    // ===== FILE HANDLING =====
    function handleFileSelect(event) {
        const input = event?.target || document.getElementById('fileInput');
        const file = input?.files?.[0];
        
        if (!file) {
            showError('No file selected');
            return;
        }

        // Validate PDF
        if (!file.name.toLowerCase().endsWith('.pdf')) {
            showError('Please upload a PDF file only');
            if (input) input.value = '';
            return;
        }

        // Validate file size (max 50MB)
        if (file.size > 50 * 1024 * 1024) {
            showError('File too large. Maximum size is 50MB');
            if (input) input.value = '';
            return;
        }

        state.currentFile = file;
        startUploadProcess(file);
    }

    function startUploadProcess(file) {
        hideError();
        
        // Show upload status
        const uploadArea = document.getElementById('uploadArea');
        const uploadStatus = document.getElementById('uploadStatus');
        
        if (uploadArea) uploadArea.classList.remove('active');
        if (uploadStatus) {
            uploadStatus.classList.add('active');
        }

        // Update file name display
        const fileNameElements = [
            document.getElementById('fileName'),
            document.getElementById('resultFileName')
        ];
        
        fileNameElements.forEach(el => {
            if (el) el.textContent = file.name;
        });

        // Start analysis
        uploadAndAnalyze(file);
    }

    async function uploadAndAnalyze(file) {
        const formData = new FormData();
        formData.append('file', file);

        try {
            // Update loading text
            const loadingText = document.getElementById('loadingText');
            if (loadingText) loadingText.textContent = 'Uploading and parsing PDF...';
            
            // Upload to /analyze endpoint
            const uploadResponse = await fetch('/analyze', {
                method: 'POST',
                body: formData
            });

            if (!uploadResponse.ok) {
                throw new Error(`Upload failed: ${uploadResponse.status}`);
            }

            const uploadData = await uploadResponse.json();

            if (!uploadData?.success) {
                throw new Error(uploadData?.error || 'Upload failed');
            }

            // Update loading text for AI analysis
            if (loadingText) loadingText.textContent = 'Generating study notes with AI...';
            
            // Get structured notes from /understand endpoint
            const analysisResponse = await fetch('/understand', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ filename: file.name })
            });

            if (!analysisResponse.ok) {
                throw new Error(`Analysis failed: ${analysisResponse.status}`);
            }

            const analysisData = await analysisResponse.json();

            if (!analysisData?.success) {
                throw new Error(analysisData?.error || 'Analysis failed');
            }

            // Store and display notes
            state.currentNotes = analysisData;
            displayStructuredNotes(analysisData);
            
            // Show success notification
            showNotification('Study notes generated successfully!', 'success');

        } catch (error) {
            console.error('Upload/Analysis error:', error);
            showError(error.message || 'Analysis failed. Please try again.');
            resetToUploadState();
        }
    }

    function displayStructuredNotes(data) {
        // Hide upload status and empty state, show results
        const uploadStatus = document.getElementById('uploadStatus');
        const analysisResults = document.getElementById('analysisResults');
        const emptyState = document.getElementById('emptyState');
        const notesContent = document.getElementById('notesContent');
        
        if (uploadStatus) uploadStatus.classList.remove('active');
        if (analysisResults) {
            analysisResults.classList.add('active');
        }
        if (emptyState) {
            emptyState.classList.add('hidden');
        }
        if (notesContent) {
            notesContent.classList.remove('hidden');
        }
        
        // Set results title
        const title = data?.filename || 'Study Notes';
        const resultsTitle = document.getElementById('resultsTitle');
        if (resultsTitle) resultsTitle.textContent = title;
        
        // Render markdown content
        let markdownContent = '';
        
        if (data?.markdown) {
            markdownContent = data.markdown;
        } else if (data?.full_notes) {
            markdownContent = data.full_notes;
        } else if (data?.markdown_content) {
            markdownContent = data.markdown_content;
        } else {
            markdownContent = constructMarkdownFromData(data);
        }
        
        if (notesContent && markdownContent) {
            try {
                notesContent.innerHTML = marked.parse(markdownContent);
                
                // Render MathJax equations
                if (window.MathJax) {
                    MathJax.typesetClear([notesContent]);
                    MathJax.typesetPromise([notesContent])
                        .then(() => {
                            console.log('MathJax: Successfully rendered equations.');
                        })
                        .catch((err) => {
                            console.error('MathJax typeset error:', err);
                        });
                }
            } catch (error) {
                console.error('Markdown parsing error:', error);
                notesContent.innerHTML = '<p>Error rendering markdown content.</p><pre>' + markdownContent + '</pre>';
            }
        } else if (notesContent) {
            notesContent.innerHTML = '<p>No content available.</p>';
        }
        
        // Set initial active section
        const notesActions = document.querySelectorAll('.btn-action[data-section]');
        if (notesActions && notesActions.length > 0) {
            showSection(state.currentSection, notesActions[0]);
        }
        
        // Scroll to results
        if (analysisResults) {
            analysisResults.scrollIntoView({ behavior: 'smooth' });
        }
    }

    function constructMarkdownFromData(data) {
        if (!data) return '# No Notes Available\n\nUpload a PDF to generate study notes.';
        
        let markdown = '';
        
        if (data.title || data.filename) {
            markdown += `# ${data.title || data.filename}\n\n`;
        }
        
        if (data.brief_overview) {
            markdown += `## üìö Brief Overview\n\n${data.brief_overview}\n\n`;
        }
        
        if (data.key_points && Array.isArray(data.key_points) && data.key_points.length > 0) {
            markdown += `## üéØ Key Points\n\n`;
            data.key_points.forEach(point => {
                if (point) markdown += `‚Ä¢ ${point}\n`;
            });
            markdown += '\n';
        }
        
        if (data.main_content) {
            markdown += `## üìñ Main Content\n\n${data.main_content}\n\n`;
        }
        
        if (data.processes) {
            markdown += `## ‚öôÔ∏è Processes / Mechanisms\n\n${data.processes}\n\n`;
        }
        
        if (data.tables) {
            markdown += `## üìä Classifications & Tables\n\n${data.tables}\n\n`;
        }
        
        if (data.examples) {
            markdown += `## üß™ Examples\n\n${data.examples}\n\n`;
        }
        
        if (data.summary) {
            markdown += `## üìù Summary\n\n${data.summary}\n\n`;
        }
        
        return markdown || '# Study Notes\n\nContent analysis completed.';
    }

    function showSection(section, buttonElement) {
        if (!section) return;
        
        state.currentSection = section;
        
        // Update active button
        const notesActions = document.querySelectorAll('.btn-action[data-section]');
        if (notesActions) {
            notesActions.forEach(btn => {
                btn.classList.remove('active');
            });
        }
        if (buttonElement) {
            buttonElement.classList.add('active');
        }
        
        // For now, we'll just show the full notes
        const notesContent = document.getElementById('notesContent');
        if (state.currentNotes?.markdown && notesContent) {
            notesContent.innerHTML = marked.parse(state.currentNotes.markdown);
            
            // Re-render math when switching sections
            if (window.MathJax) {
                MathJax.typesetClear([notesContent]);
                MathJax.typesetPromise([notesContent])
                    .then(() => {
                        console.log('MathJax re-rendered for section:', section);
                    })
                    .catch((err) => {
                        console.error('MathJax section render error:', err);
                    });
            }
        }
    }

    function downloadNotes() {
        if (!state.currentNotes) {
            showNotification('No notes to download', 'error');
            return;
        }
        
        let markdown = '';
        if (state.currentNotes.markdown) {
            markdown = state.currentNotes.markdown;
        } else {
            markdown = constructMarkdownFromData(state.currentNotes);
        }
        
        const filename = `study-notes-${Date.now()}.md`;
        const blob = new Blob([markdown], { type: 'text/markdown;charset=utf-8' });
        saveAs(blob, filename);
        showNotification('Notes downloaded successfully!', 'success');
    }

    function clearAnalysis() {
        state.currentFile = null;
        state.currentNotes = null;
        
        // Reset UI
        const analysisResults = document.getElementById('analysisResults');
        const initialOptions = document.getElementById('initialOptions');
        const uploadArea = document.getElementById('uploadArea');
        const uploadStatus = document.getElementById('uploadStatus');
        const emptyState = document.getElementById('emptyState');
        const notesContent = document.getElementById('notesContent');
        const fileInput = document.getElementById('fileInput');
        
        if (analysisResults) analysisResults.classList.remove('active');
        if (initialOptions) initialOptions.classList.remove('hidden');
        if (uploadArea) uploadArea.classList.remove('active');
        if (uploadStatus) uploadStatus.classList.remove('active');
        if (emptyState) emptyState.classList.remove('hidden');
        if (notesContent) {
            notesContent.classList.add('hidden');
        }
        if (fileInput) fileInput.value = '';
        
        hideError();
        showNotification('Analysis cleared', 'info');
    }

    function showError(message) {
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        
        if (errorMessage && errorText) {
            errorText.textContent = message || 'An error occurred';
            errorMessage.classList.add('active');
        }
    }

    function hideError() {
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage) {
            errorMessage.classList.remove('active');
        }
    }

    function resetToUploadState() {
        const uploadStatus = document.getElementById('uploadStatus');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        if (uploadStatus) uploadStatus.classList.remove('active');
        if (uploadArea) uploadArea.classList.add('active');
        if (fileInput) fileInput.value = '';
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.innerHTML = `
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: ${type === 'success' ? 'rgba(0, 255, 0, 0.1)' : type === 'error' ? 'rgba(255, 0, 0, 0.1)' : 'rgba(0, 0, 255, 0.1)'};
            color: ${type === 'success' ? '#0d9d58' : type === 'error' ? '#d93025' : '#1a73e8'};
            padding: 16px 24px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            max-width: 400px;
            border: 1px solid ${type === 'success' ? 'rgba(0, 255, 0, 0.2)' : type === 'error' ? 'rgba(255, 0, 0, 0.2)' : 'rgba(0, 0, 255, 0.2)'};
            backdrop-filter: blur(10px);
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 4000);
    }

    function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function setupDragAndDrop() {
        const uploadArea = document.getElementById('uploadArea');
        if (!uploadArea) return;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            uploadArea.style.borderColor = 'rgba(255, 255, 255, 0.4)';
            uploadArea.style.background = 'rgba(255, 255, 255, 0.12)';
        }

        function unhighlight() {
            uploadArea.style.borderColor = '';
            uploadArea.style.background = '';
        }

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const file = dt?.files?.[0];
            
            if (file && file.name.toLowerCase().endsWith('.pdf')) {
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                const fileInput = document.getElementById('fileInput');
                if (fileInput) {
                    fileInput.files = dataTransfer.files;
                    handleFileSelect({ target: fileInput });
                }
            } else if (file) {
                showError('Please drop a PDF file only');
            }
        }
    }

    // Add CSS for fadeOut animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
    `;
    document.head.appendChild(style);
</script>
</body>
</html>
